(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,52356,e=>{"use strict";var s=e.i(28432),a=e.i(46149);function r(){let[e,r]=(0,s.useState)({loading:!0,user:null});return(0,s.useEffect)(()=>{let e=!0;a.supabase.auth.getUser().then(({data:s})=>{e&&r({loading:!1,user:s.user??null})});let{data:s}=a.supabase.auth.onAuthStateChange((s,a)=>{e&&r({loading:!1,user:a?.user??null})});return()=>{e=!1,s.subscription.unsubscribe()}},[]),e}e.s(["useUser",()=>r])},82739,e=>{"use strict";var s=e.i(17220),a=e.i(28432),r=e.i(19355),t=e.i(46149),l=e.i(52356);function n(){let e=(0,r.useRouter)(),{loading:n,user:i}=(0,l.useUser)(),u=(0,a.useRef)(null),[c,d]=(0,a.useState)(null),[o,p]=(0,a.useState)("");(0,a.useEffect)(()=>{n||i||e.replace("/login")},[n,i,e]);let m=async()=>{if(p(""),!i)return p("로그인이 필요합니다.");if(!c)return p("파일을 선택하세요.");try{let s=c.name.split(".").pop()||"bin",a=`${i.id}/${crypto.randomUUID()}.${s}`,{error:r}=await t.supabase.storage.from("user-uploads").upload(a,c,{upsert:!1});if(r)return p(`업로드 실패: ${r.message}`);let{data:l,error:n}=await t.supabase.storage.from("user-uploads").createSignedUrl(a,3600);if(n||!l?.signedUrl)return p(`URL 생성 실패: ${n?.message??"unknown"}`);let{error:u}=await t.supabase.from("uploads").insert({user_id:i.id,file_path:a,file_url:l.signedUrl});if(u)return p(`DB 저장 실패: ${u.message}`);p("업로드 완료! 내 이미지로 이동합니다."),e.push("/me")}catch(e){p(`예외 발생: ${e?.message??String(e)}`)}};return n?(0,s.jsx)("main",{className:"p-8",children:"Loading..."}):i?(0,s.jsxs)("main",{className:"min-h-screen p-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"업로드"}),(0,s.jsx)("p",{className:"mt-2 opacity-80",children:"이미지 파일을 업로드하면 내 목록에 저장됩니다."}),(0,s.jsx)("input",{ref:u,type:"file",accept:"image/*",className:"hidden",onChange:e=>{let s=e.target.files?.[0]??null;d(s),s&&p("")}}),(0,s.jsxs)("div",{className:"mt-6 space-y-3",children:[(0,s.jsx)("button",{className:"border rounded px-3 py-2",onClick:()=>{p(""),u.current?.click()},children:"파일 선택"}),(0,s.jsxs)("div",{className:"text-sm opacity-80",children:["선택된 파일: ",c?c.name:"없음"]}),(0,s.jsx)("button",{className:"border rounded px-3 py-2",onClick:m,children:"업로드"}),o&&(0,s.jsx)("p",{className:"text-sm opacity-80",children:o})]}),(0,s.jsxs)("div",{className:"mt-6 space-x-4",children:[(0,s.jsx)("a",{className:"underline",href:"/me",children:"내 이미지"}),(0,s.jsx)("a",{className:"underline",href:"/dashboard",children:"대시보드"})]})]}):null}e.s(["default",()=>n])}]);